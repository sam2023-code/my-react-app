pipeline {
    agent any

    environment {
        DOCKER_IMAGE = 'samchan930423/reactdocker:latest' // e.g., 'nginx:latest'
        CONTAINER_NAME = 'Jenkins-react-container'
    }

    stages {

         stage('Install Dependencies') {
            steps {
                script {
                    dir('C:/Users/User/Desktop/React_demo/my-react-app') 
                        {
                            bat 'npm install --legacy-peer-deps'
                        }
                }
            }
        }
        
        stage('Build Application') {
            steps {
                script {
                    dir('C:/Users/User/Desktop/React_demo/my-react-app') {bat 'npm run build'}
                }
            }
        }
        stage('Build Docker Image') {
            steps {
                script {
                    dir('C:/Users/User/Desktop/React_demo/my-react-app'){bat "docker build -t ${DOCKER_IMAGE} ."}
                }
            }
        }
        
        
        stage('Push to Docker Hub') {
            steps {
                script {
                    withCredentials([usernamePassword(credentialsId: 'dockerhub-credentials', passwordVariable: 'DOCKERHUB_PASSWORD', usernameVariable: 'DOCKERHUB_USERNAME')]) {
                        bat "echo ${DOCKERHUB_PASSWORD} | docker login -u ${DOCKERHUB_USERNAME} --password-stdin"
                        bat "docker push ${DOCKER_IMAGE}"
                    }
                }
            }
        }
    }
}